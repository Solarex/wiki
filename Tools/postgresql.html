<!DOCTYPE HTML>
<html>
    <head>
        <link rel="Stylesheet" type="text/css" href="../static/css/typo.css">
        <link rel="Stylesheet" type="text/css" href="../static/css/reset_typo.css">
        <link rel="Stylesheet" type="text/css" href="../static/css/tango.css">
        <link rel="Stylesheet" type="text/css" href="../static/css/style.css">
        <title>postgresql - Wiki·Solarex</title>
        <meta name="keywords" content="android,linux,python,mac"/>
        <meta name="description" content="Solarex's personal wiki,powered by simiki.Focus on Android, Python, Linux, Mac and so on."/>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        
<script src="http://apps.bdimg.com/libs/jquery/2.1.4/jquery.js"></script>
<script language="javascript" type="text/javascript">
    var oddClick = true;
    $(document).ready(function() {
      $('#toggle-button').click(function() {
        $('#container').animate({
          width: oddClick? "100%":"60%",
        });
        $(this).text(oddClick? "窄版":"宽版");
        oddClick = !oddClick;
      });
    });
</script>

    </head>

    <body>
        <a href="https://github.com/Solarex/wiki"><img style="position: fixed; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/365986a132ccd6a44c23a9169022c0b5c890c387/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f7265645f6161303030302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png"></a>
        <div id="container">
            
    <div id="header">
        <div id="post-nav">
            <div id="toggle-button">宽版</div>
            
            <a href="https://solarex.github.io/wiki/">Home</a> » <a href="https://solarex.github.io/wiki/#Tools">Tools</a> » postgresql
            
        </div>
    </div>
    <div class="clearfix"></div>
    <h1><center>postgresql</center></h1>
    <hr>
    <div id="content">
        <h1 id="postgresql">postgresql</h1>
<ul>
<li><code>createdb</code>,Normally, the database user who executes this command becomes the owner of the new database. However, a different owner can be specified via the <code>-O</code> option, if the executing user has appropriate privileges.</li>
<li><code>dropdb</code>,<code>dropdb</code> destroys an existing PostgreSQL database. The user who executes this command must be a database superuser or the owner of the database.</li>
<li><code>pg_dump</code>,<code>pg_dump</code> is a utility for backing up a PostgreSQL database. It makes consistent backups even if the database is being used concurrently.<code>pg_dump</code> does not block other users accessing the database (readers or writers).<code>pg_dump --inserts --clean sql_book &gt; dump.sql</code></li>
<li><code>psql -d sql_book &lt; dump.sql</code>,restoring a database with psql.The -d option specifies which database to connect to. The use of <code>&lt;</code> reads the contents of the file dump.sql into the <code>psql</code> command. This will allow use to restore the data of our database if it has been lost or altered after using <code>pg_dump</code>.</li>
<li><code>psql \c library</code>,change database</li>
<li><code>psql \dt</code>,displays all tables for the current database</li>
<li><code>psql \l</code>,<code>psql \list</code>,display all databases</li>
<li><code>psql \d users</code>,describe the table</li>
<li><code>create table users (id serial, username char(25) not null, enabled boolean default true, primary key (id));</code></li>
<li><code>insert into users (id, username, enabled) values (20, 'john snow', false);</code></li>
<li><code>insert into users (username) values ('aya starke');</code></li>
<li><code>insert into users (username, enabled) values ('little finger', false);</code></li>
<li><code>select * from users</code>,<code>select username from users</code>,<code>select id,username from users</code></li>
<li><code>select username from users where enabled = true;</code></li>
<li><code>select id,username from users order by username;</code></li>
<li><code>select id,username from users order by id desc;</code>,<code>select id,username from users order by id asc</code></li>
<li><code>delete from users;</code></li>
<li><code>update users set enabled = true where id = 4;</code></li>
<li><code>update users set enabled = false where rtrim(username) like '% II';</code></li>
<li><code>delete from users where username = 'John Smith';</code></li>
<li><code>alter table users add column last_login timestamp not null default NOW();</code></li>
<li><code>alter table users rename column username to full_name;</code></li>
<li><code>alter table users alter column full_name type varchar(25);</code></li>
<li><code>alter table users drop column enabled;</code></li>
<li><code>alter table users rename to all_users;</code></li>
<li><code>DML,Data Manipulation Statements</code>,<code>CRUD</code>,<code>insert,select,update,delete</code></li>
<li><code>DDL</code>,<code>Data Definition Statements</code>,<code>createdb</code>,<code>create table</code>,<code>\d table_name</code>,<code>psql table_name</code>,<code>drop database</code>,<code>alter table</code>,<code>drop table</code></li>
<li>ERD,An entity relationship diagram is a graphical representation of entities and their relationships to each other. An entity is a piece of data.</li>
<li><code>create table users(id serial, username varchar(25) not null, enabled boolean default true, last_login timestamp not null default now(), primary key (id));</code> The <code>NOT NULL</code> constraint prevents a column from allowing a null value</li>
<li><code>create table addresses(user_id int not null, street varchar(30) not null, city varchar(30) not null, state varchar(30) not null, primary key (user_id),constraint fk_user_id foreign key (user_id) references users);</code></li>
<li><code>create table books (id serial, title varchar(100) not null, author varchar(100) not null, published_date timestamp not null, isbn int, primary key (id), unique(isbn));</code>The Unique constraint disallows duplicate entry into the books table for the column value of isbn.</li>
<li><code>create table reviews (id serial, book_id int not null, user_id int not null, review_content varchar(255), rating int, published_date timestamp default now(), primary key (id), foreign key (book_id) references books(id) on delete cascade, foreign key (user_id) references users(id) on delete cascade);</code>The <code>ON DELETE CASCADE</code> clause indicates that if a book/user is deleted all reviews associated with that book/user are also deleted.</li>
<li><code>create table user_books(user_id int not null, book_id int not null, checkout_date timestamp, return_date timestamp, primary key (user_id, book_id), foreign key (user_id) references users(id) on update cascade, foreign key (book_id) references books(id) on update cascade);</code>When a primary_key consists of a unique pair <code>PRIMARY KEY (user_id, book_id)</code>, it is known as a composite key. It usually occurs in many-to-many relationships, and we need to add an extra table to store this relationship data. The composite key ensures that the data in the table will be unique for the relation between the user and book.</li>
<li>A <strong>Primary Key</strong> is a unique identifier for a row of data.</li>
<li><strong>Foreign key</strong> columns are used to reference another row of data, perhaps in another table. In order to reference another row, the database needs a unique identifier for that row. Therefore, foreign key columns contain the value of the referenced row's primary key.Foreign keys are how RDBMS sets up relationships between rows of data, either in the same table or across tables.</li>
<li>PostgreSQL allows relationships between both the schema and data of different tables through the use of <strong>FOREIGN KEYS</strong> and an operation called a <code>JOIN</code>. </li>
<li>JOINs are clauses in SQL statements that link two tables based on one or more fields. With JOINs, relational databases can reduce redundancy.</li>
<li>An <code>INNER JOIN</code> returns a result set that contains the common elements of the tables, i.e the intersection where they match on the joined column. <code>select users.*,addresses.* from users inner join addresses on users.id = addresses.user_id;</code></li>
<li>A LEFT JOIN or a LEFT OUTER JOIN takes all the rows from one table, defined as the <code>LEFT</code> table, and <code>JOIN</code>s it with a second table. The JOIN is based on the conditions supplied in the parentheses. A <code>LEFT JOIN</code> will always include the rows from the <code>LEFT</code> table, even if there are no matching rows in the table it is JOINed with.What's being said in SQL is "give me all the matching rows from the left table along with any matching data from the RIGHT table based on the ON clause".</li>
<li>A CROSS JOIN, also known as a Cartesian JOIN, returns all rows from one table crossed with every row from the second table. This JOIN does not have an ON clause.<code>SELECT * FROM users CROSS JOIN addresses;</code></li>
<li>A <code>RIGHT JOIN</code> is similar to a <code>LEFT JOIN</code> except that all the data on the second table is included.</li>
<li><code>pg_dump --inserts --no-acl --clean library &gt; library.sql</code>,<code>psql -d library &lt; library.sql</code></li>
<li><code>copy (select u.username, b.title from users u inner join users_books ub on (ub.user_id = u.id) inner join books b on (b.id = ub.book_id)) to '/tmp/users_books.csv' with cvs;</code></li>
<li><code>copy (select u.username, b.title from users u inner join users_books ub on (ub.user_id = u.id) inner join books on (b.id = ub.book_id)) to '/tmp/users_books.csv' with csv header;</code></li>
<li>PostgreSQL使用C/S架构模型，客户端psql终端输入的命令必须传送给server来进行执行处理，<code>copy</code>命令必须使用绝对路径，服务端不知道客户端所在的路径。<code>\copy</code>可以使用相对路径。</li>
<li><code>\copy books (title, author, published_date) FROM './gutenberg_books.csv' DELIMITER ','  CSV;</code></li>
<li><code>SELECT CONCAT(title,' by ', author) AS "Books By" FROM books;</code>,format data</li>
<li><code>SELECT COUNT(id) AS enabled_count FROM users WHERE enabled = true;</code>,aliasing</li>
<li><code>SELECT DISTINCT u.username FROM users LEFT JOIN  users_books ub ON (ub.user_id = u.id);</code></li>
<li><code>SELECT title, author FROM books LIMIT 5;</code></li>
<li><code>SELECT u.username FROM users WHERE u.id NOT IN (SELECT ub.user_id FROM users_books ub);</code></li>
<li><a href="https://www.postgresql.org/docs/current/static/using-explain.html">using explain</a></li>
<li>​</li>
</ul>
    </div>

        </div>
        <div id="footer">
              <p>
                Copyright © 2012-2017 Solarex.
                Powered by <a href="http://simiki.org/" target="_blank">Simiki</a>.
              </p>
                <p>Last Update 2017-04-13 08:48:25</p>
        </div>
    </body>
</html>